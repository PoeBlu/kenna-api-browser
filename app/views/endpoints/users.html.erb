<% if !user_signed_in? %>
909<script type="text/javascript">
      alert('You need to be logged in to see this page.');
    window.location.href="/users/sign_in";
  </script>
<% else %>
<%
require 'net/https'
require 'uri'
require 'json'

token = "ty9hxcpmgdrvnuqe"
url = URI.parse("https://api.kennasecurity.com")

@meth = 'GET'
@base_url = 'https://api.kennasecurity.com'
@endpoint = '/users'
@params = ''
@url = @base_url + @endpoint + @params;
@data = []

http = Net::HTTP.new(url.host, 443)
http.use_ssl = true
http.start do |http|
  
  request  =
    Net::HTTP::Get.new(@endpoint + @params, {'X-Risk-Token' => token, 'Accept' => 'application/json'})
  response = http.request(request)
  #data = JSON.pretty_generate JSON.parse(response.body)["users"]
  @data = JSON.parse(response.body)["users"]
end
%>


<script>
  $(document).ready( function () {
    $('#table_id').DataTable();
} );
</script>

<div class="container">
      <div class="row" style="margin:0;">

        <div class="card white">
          
          <div class="card-title" style="margin-bottom:0; padding:6;color:white; background-color:#34495e;">
            <p style="text-align:center;"><%= @meth %> | <%= @url %></p>
          </div>

          <div class="card-content black-text" style="padding-top:0; margin-top:o;  margin-bottom:o;">
            
            <div style="margin-bottom:0; margin-top:0; padding:6;color:white; background-color:grey;">
              <p style="text-align:center;">Users | <%= @meth %> | <%= @url %></p>
            </div>

            
              <table id="table_id" class="display" style="padding-top:0; margin-top:o">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Role</th>
                    <th>Role ID</th>
                    <th>Last Login</th>
                    <th>Created At</th>
                    <th>Updated At</th>
                  </tr>
                </thead>
                
                <tbody>

<%

  @data.each do |d| 
  



%>

<a href="/">
                    <tr>
                        <td><%= d['id'] %></td>
                        <td><%= d['firstname'] %></td>
                        <td><%= d['lastname'] %></td>
                        <td><%= d['email'] %></td>
                        <td><%= d['phone'] %></td>
                        <td><%= d['role'] %></td>
                        <td><%= d['role_id'] %></td>
                        <td><%= d['last_sign_in_at'] %></td>
                        <td><%= d['created_at'] %></td>
                        <td><%= d['updated_at'] %></td>
                    </tr>
                    </a>
<% end %>
                </tbody>
            </table>
            
          </div>
        </div>

    
    
    
     </div>
    </div>
<% end  %>